# FlightAcademy データベース設定

このディレクトリには、FlightAcademyアプリケーションのデータベース設定に関するファイルが含まれています。

## 概要

このプロジェクトでは、Supabaseをバックエンドとして使用しており、以下のテーブルが定義されています：

1. **profiles**: ユーザープロフィール情報を保存
2. **progress**: ユーザーの学習進捗状況を保存

## セットアップ手順

### Supabaseプロジェクトでのセットアップ

1. [Supabaseダッシュボード](https://app.supabase.io)にログインします
2. 対象のプロジェクトを選択します
3. 左側のメニューから「SQL Editor」を選択します
4. 「New Query」ボタンをクリックします
5. `schema.sql`ファイルの内容をコピーして貼り付けます
6. 「Run」ボタンをクリックしてSQLを実行します

## セキュリティ（RLS）について

データベースはRow Level Security (RLS)ポリシーで保護されています：

### profilesテーブル

- ユーザーは自分のプロフィールのみを閲覧・更新できます
- 新規ユーザー登録時には自動的にプロフィールが作成されます

### progressテーブル

- ユーザーは自分の学習進捗のみを閲覧・更新・削除できます

## トリガー

以下の自動化トリガーが設定されています：

1. ユーザー登録時にプロフィールを自動作成するトリガー
2. レコード更新時に`updated_at`フィールドを更新するトリガー

## 問題解決

セットアップ中に問題が発生した場合：

1. SQLエラーの詳細を確認してください
2. テーブルが既に存在する場合は、`IF NOT EXISTS`を使用しているため、エラーは発生しません
3. RLSポリシーが既に存在する場合は、ポリシーの削除（`DROP POLICY IF EXISTS ...`）を先に実行することで解決できます 