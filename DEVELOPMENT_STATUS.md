# FlightAcademyTsx - 開発状況

このドキュメントでは、FlightAcademyTsxの現在の実装状況、課題、および今後の開発計画を記載しています。

- [基本情報とセットアップ](./README.md)
- [技術仕様と実装詳細](./DOCUMENTATION.md)

## 現在の実装状況

### ✅ 基本機能
- インタラクティブな地図表示（Leaflet.js）
- 基本レイヤー（地図、衛星写真）の切り替え
- オーバーレイレイヤー（空港、制限空域、高高度訓練空域など）の表示
- 空港、ウェイポイント、NAVAIDの表示と対話機能
- フライトパラメータ（速度、高度、出発時間）の設定と計算
- フライトプランの作成と管理（出発地、経由地、目的地）
- ウェイポイントのマップ上からの追加（ダブルクリックまたはポップアップのボタン）
- フライトサマリーの計算（総距離、ETE、ETA）
- ルートセグメントごとの詳細情報（速度、磁方位、高度、ETA）の表示
- コンパルサリーポイントと非コンパルサリーポイントの視覚的区別

### ✅ 空港情報
- 空港アイコンの表示
- 空港クリック時の詳細情報ポップアップ
- 空港の気象情報取得と表示（WeatherAPI経由）
  - 天気状態（英語と日本語表記）
  - 温度と体感温度
  - 湿度
  - 風向風速（日本語変換対応）
  - 気圧
  - 視界
  - 降水量
  - UV指数
  - 日の出・日の入り時刻
  - 最終更新時刻

### ✅ 最近追加された機能（直近1ヶ月）
- 「ルートに追加」ボタンによるマップ上からのウェイポイント追加
- セグメントごとの詳細情報（CAS、磁方位、高度、ETA）の計算と表示
- 空港マーカーの改善（黒丸と制御圏の表示）
- ウェイポイントデータの管理改善：
  - アルファベット別・地域別のデータ分割によるパフォーマンス最適化
  - 座標形式の統一（経度：ddd.dddd、緯度：dd.dddd）
  - IDによるアルファベット順ソート実装
  - name1フィールドの一貫性確保
  - 各種管理スクリプトの開発と整備（マージ、変換、追加、ソート、更新）

## 現在の技術的課題

### API管理
- **環境変数によるAPIキー管理**: 
  - 現在、Weather APIキーは`.env.local`ファイルで管理されていますが、一部環境で読み込みに問題が発生
  - フォールバックとしてハードコードされたキーを使用中（セキュリティ上の懸念あり）

### CORS対応
- WeatherAPIへの直接アクセスでCORS問題が発生する可能性あり
- 現在の対応は部分的であり、すべての環境で安定動作するか検証が必要

### UI/UX
- 空港アイコンの視認性向上が必要
- 気象情報ポップアップのデザイン最適化

### パフォーマンス
- 大量のウェイポイントを扱う際のパフォーマンス最適化が必要
- GeoJSONデータの効率的な読み込みと処理の改善

### 型安全性
- 一部のコードで型アノテーションの強化が望ましい
- 特にイベントハンドラやコンポーネント間のデータ受け渡しで改善の余地あり

## 今後の開発計画

### 短期計画（〜1ヶ月）
- **APIキー管理の改善**:
  - サーバーサイドプロキシの実装によるAPIキーの保護
  - 環境変数管理の安定化
- **UI改善**:
  - 空港アイコンのカスタマイズと視認性向上
  - 気象情報ポップアップのタブ化またはアコーディオン実装
- **ウェイポイント機能強化**:
  - ウェイポイントの編集と削除機能の強化
  - 各セグメントごとに異なる高度と速度の設定
- **ウェイポイントデータ管理**:
  - リファクタリングされたスクリプトのさらなる機能拡張
  - 追加・更新作業のワークフロー効率化

### 中期計画（1〜3ヶ月）
- **フライトプラン機能の強化**:
  - フライトプランの保存と読み込み機能
  - ルート計画の詳細設定
  - 高度プロファイルの視覚化
  - 燃料計算の実装
- **気象情報の拡張**:
  - 予報データの表示（24時間、3日間）
  - 空域ごとの気象条件表示
  - METARとTAFの統合
- **ドキュメント整備**:
  - コード内のコメントとドキュメントの充実
  - 自動APIドキュメント生成の検討

### 長期計画（3ヶ月〜）
- **シミュレーション統合**:
  - フライトシミュレーターとの連携
  - リアルタイムデータの同期
- **コミュニティ機能**:
  - ユーザー間でのフライトプラン共有
  - コメントと評価システム
- **テスト強化**:
  - 自動テストの導入と整備
  - CI/CDパイプラインの充実
- **モバイル対応**:
  - レスポンシブデザインの完全対応
  - PWA（Progressive Web App）化
- **プリントアウト機能**:
  - フライトログと計画書の出力機能

## セキュリティと環境変数

### 安全な環境変数管理への移行計画
現在の実装では、環境変数の読み込みに問題がある場合にハードコードされた値にフォールバックする仕組みがありますが、セキュリティ上の理由から以下の改善を計画しています：

1. **バックエンドプロキシの実装**:
   - フロントエンドからAPIキーを完全に除去
   - すべてのAPI呼び出しをバックエンドプロキシ経由に変更

2. **環境変数の一元管理**:
   - 本番環境: CI/CDパイプラインによる環境変数の安全な注入
   - 開発環境: .env.localの使用（gitignoreに含める）

3. **環境変数のバリデーション**:
   - アプリケーション起動時に必要な環境変数の存在確認
   - 適切なエラーメッセージの表示

## 貢献方法
プロジェクトへの貢献をご希望の方は、以下の点にご注意ください：

1. APIキーなどの機密情報をコードにハードコードしないでください
2. `.env.example`ファイルを参照し、必要な環境変数を`.env.local`に設定してください
3. コードを提出する前に、すべての機密情報が適切に管理されていることを確認してください
4. 新機能の実装や課題の修正に取り組む前に、issueを作成して対応方針を相談してください

---

最終更新日: 2025年5月10日 