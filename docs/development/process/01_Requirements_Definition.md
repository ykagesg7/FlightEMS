# 01 要件定義書

## 1. プロジェクト概要
本プロジェクトは、Webベースの4択問題アプリケーションを開発することを目的とします。特に、最新の脳科学や学習理論を取り入れ、効率的な暗記と長期記憶への定着を支援する機能を盛り込むことを目指します。ユーザーは問題デッキを作成・学習し、進捗や苦手分野を把握しながら効果的に知識を習得できます。既存のFlightAcademyプロジェクトに統合され、React, TypeScript, Supabase, Vite, Tailwind CSSの技術スタックで開発されます。

## 2. ターゲットユーザー
*   FlightAcademyの既存ユーザー
*   事業用操縦士（飛行機）国家試験の学習者
*   その他、資格試験や専門知識の習得を目指す学習者全般

## 3. 機能要件

### 3.1 必須機能 (MVPのコア)
    *   **ユーザー認証機能**
        *   [x] ユーザー登録 (メールアドレス、パスワード、ユーザー名)
        *   [x] ログイン・ログアウト
        *   [x] パスワードリセット (Supabase Auth標準機能利用)
    *   **問題カテゴリ機能**
        *   [x] 事前定義されたカテゴリ表示 (例: 航法, 航空法規, 気象, 機体, 通信)
        *   [ ] (Admin向け) カテゴリ作成・編集・削除機能 (`04_UI_UX_Specification.md` F.問題管理画面で詳述)
    *   **カードデッキ機能**
        *   [x] カテゴリに紐づくデッキの一覧表示
        *   [x] デッキ選択機能
        *   [ ] (Admin向け) デッキ作成・編集・削除機能 (`04_UI_UX_Specification.md` F.問題管理画面で詳述)
    *   **4択問題解答機能**
        *   [x] 問題文と4つの選択肢の表示
        *   [x] 解答選択機能 (ラジオボタン形式など)
        *   [x] 解答送信機能
        *   [x] 正誤判定とフィードバック表示 (正解の選択肢、解説文、解説画像)
        *   [x] 次の問題へ進む機能
    *   **スコア・進捗管理機能**
        *   [x] 学習セッションごとのスコア表示 (正解数/問題数, 正解率)
        *   [x] (ダッシュボード) 総学習問題数、平均正解率、学習日数の表示
        *   [ ] リーダーボード機能 (MVP範囲外、将来検討)
    *   **問題管理機能 (Admin向け)**
        *   [x] 問題作成・編集・削除機能 (`04_UI_UX_Specification.md` F.問題管理画面で詳述)
        *   [x] 1カードデッキにつき50問までの制限 (初期仕様、将来的には緩和検討)
        *   [x] 問題へのマーク機能 (ユーザーが「チェック」「わからない」を任意で付与/解除)
        *   [ ] 正解した問題への自動マーク付与 (学習履歴に基づき、復習画面等で活用。具体的な表示・動作はUI/UXで定義)
    *   **出題順序設定**
        *   [ ] (MVPでは) デッキ内の問題をランダムに出題
        *   [ ] (将来検討) 日付順、ユーザー設定順

### 3.2 便利機能 (MVPに含める学習支援・エンゲージメント向上機能)
    *   **学習支援機能**
        *   [x] 難易度レベル設定 (問題ごとに 'easy', 'medium', 'hard' を設定し、表示やフィルタリングに利用可能性を検討)
        *   [x] タイマー機能
            *   [x] システム全体で一律の規定時間 (例: 60秒/問) からカウントダウン表示
            *   [x] 残り時間0秒になっても解答は続行可能
            *   [x] 解答にかかった時間を記録 (`learning_records.response_time_ms`)
        *   [x] 復習機能
            *   [x] 間違えた問題の再出題 (SRSとは別に、セッション直後や特定タイミングでの復習機会提供を検討)
            *   [x] (SRS) 間隔反復学習システムによる復習問題の提示 (詳細は3.3)
        *   [x] 解説文への画像添付機能 (問題作成時)
    *   **エンゲージメント向上機能 (MVP範囲)**
        *   [x] (ダッシュボード) カテゴリ別正答率レーダーチャート (苦手分野の可視化)
        *   [ ] デイリーチャレンジ (MVP範囲外、将来検討)
        *   [ ] 報酬・バッジシステム (MVP範囲外、将来検討)
    *   **その他**
        *   [ ] マルチプレイヤーモード (MVP範囲外)
        *   [ ] オフラインモード対応 (MVP範囲外、PWA化などで将来検討)
        *   [ ] テーマカラー変更機能 (MVP範囲外)

### 3.3 脳科学的機能 (SRS: 間隔反復学習システム - MVPのコア)
    *   [x] **間隔反復スケジューリング**
        *   [x] ユーザーの解答履歴 (正誤) に基づき、各問題の最適な復習タイミングを計算 (簡略版SM-2アルゴリズムベース)。
        *   [x] 復習間隔は徐々に広げていく (例: 1日後, 3日後, 7日後, 16日後...)。
        *   [x] `user_question_srs_status` テーブルで `next_review_date`, `interval_days`, `ease_factor`, `repetitions` を管理。
    *   [x] **復習問題の提示**
        *   [x] (ダッシュボード) 「今日の復習」セクションに、復習時期が来た問題がある場合に通知し、学習セッションを開始できるようにする。
        *   [x] 学習セッション内で、復習対象の問題を優先的に出題するロジックを検討。
    *   [x] **アルゴリズムの入力**
        *   [x] 主にユーザーの正誤情報を使用。
        *   [ ] (将来検討) 解答時間 (`response_time_ms`) もアルゴリズムの調整に加味する可能性。

### 3.4 AIパーソナライズ機能 (MVP範囲)
    *   [x] **苦手カテゴリ推薦**
        *   [x] ユーザーの解答履歴から、カテゴリごとの正答率と解答数を集計。
        *   [x] 正答率が一定以下 (例: 60%) かつ解答数が一定以上 (例: 10問) のカテゴリを「苦手カテゴリ」として判定。
        *   [x] (ダッシュボード) 苦手カテゴリをいくつか推薦し、学習を促す。
    *   [x] **学習状況の可視化**
        *   [x] (ダッシュボード) カテゴリ別正答率レーダーチャート。
        *   [x] (ダッシュボード) 全体的な学習進捗サマリー。
    *   [ ] (将来検討) ユーザーの学習履歴に基づく弱点問題の自動検出・提示。
    *   [ ] (将来検討) 個人の理解度に合わせた問題の自動生成 (外部AI連携)。
    *   [ ] (将来検討) 予測符号化理論に基づく適応学習 (問題パターンの戦略的投入)。
    *   [ ] (将来検討) メタ認知支援機能の強化 (解答前後の自信度と実際の正誤の比較分析など)。

### 3.5 管理・分析機能 (ロールベース)
    *   **共通**
        *   [x] 学習履歴の基本的な閲覧 (自身の記録)
    *   **Admin向け**
        *   [x] 問題情報 (カテゴリ、デッキ、問題) の追加・編集・削除
        *   [x] エクセル・テキスト(CSV/TSV形式)からの一括問題登録
            *   [x] 1CSVファイル = 1デッキ。インポート時にユーザーが「デッキ名」と「カテゴリ」を指定。
            *   [x] CSVフォーマット: `question_text,option1,option2,option3,option4,correct_option_index,explanation,difficulty_level`
        *   [x] Student全体の学習情報閲覧 (概要レベル)
    *   **Teacher向け** (Admin権限の一部または同等)
        *   [x] Studentの質問に回答する機能 (アプリ内メッセージング等はMVP範囲外。まずは学習情報の閲覧とオフラインでのサポートを想定)
        *   [x] Student全体の学習情報閲覧 (概要レベル)

## 4. 非機能要件 (概要 - 各項目詳細は今後具体化)
    *   [ ] **パフォーマンス**:
        *   [ ] 問題表示、解答送信のレスポンスタイムはX秒以内。
        *   [ ] ダッシュボード表示はY秒以内。
        *   [ ] 同時アクセスユーザー数Z人程度を想定 (初期は50名以内)。
    *   [ ] **セキュリティ**:
        *   [x] Supabase RLS (Row Level Security) を活用し、ユーザーデータへのアクセス制御を徹底。
        *   [x] パスワードは適切にハッシュ化 (Supabase Auth標準)。
        *   [ ] 個人情報保護に関する配慮。
    *   [ ] **ユーザビリティ**:
        *   [ ] 直感的で分かりやすいUIデザイン。
        *   [ ] モバイルフレンドリーなレスポンシブデザイン。
        *   [ ] 主要な操作は3クリック以内で到達可能 (努力目標)。
        *   [ ] (将来検討) アクセシビリティ (WCAG標準など) への配慮。
    *   [ ] **メンテナンス性**:
        *   [x] コードの可読性、保守性を高めるためTypeScriptを採用。
        *   [x] コンポーネントベースのUI構築 (React)。
        *   [ ] 適切なコメントとドキュメント。
        *   [ ] 変更容易性、テスト容易性。
    *   [ ] **スケーラビリティ**:
        *   [x] SupabaseのBaaSとしてのスケーラビリティを活用。
        *   [ ] 将来的なユーザー数・データ量増加に対応できる設計を意識。
    *   [ ] **信頼性・可用性**:
        *   [x] ホスティングサービス (Vercel/Firebase) のSLAに準拠。
        *   [ ] 定期的なデータバックアップ (Supabase標準機能)。

## 5. ロール定義と権限
    *   **Student (一般ユーザー)**
        *   [x] 自身のプロファイル編集 (一部)
        *   [x] 問題の解答
        *   [x] 自身の学習履歴・進捗の閲覧
        *   [x] 問題へのマーク付与
    *   **Teacher**
        *   [x] Studentの全権限
        *   [x] (担当する) Studentの学習情報・進捗の閲覧
        *   [ ] (将来検討) Studentへのフィードバック機能 (アプリ内)
        *   [ ] (将来検討) 特定のStudentグループへの課題割り当て
    *   **Admin**
        *   [x] Teacherの全権限 (実質的に全Studentの情報を閲覧可能)
        *   [x] システム全体のユーザー管理 (ロール変更など)
        *   [x] 問題カテゴリの作成・編集・削除
        *   [x] カードデッキの作成・編集・削除
        *   [x] 問題の作成・編集・削除 (CSVインポート含む)
        *   [ ] (将来検討) システム設定変更 (タイマーのデフォルト時間など)