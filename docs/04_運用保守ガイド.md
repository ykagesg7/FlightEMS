# FlightAcademyTsx 運用保守ガイド

## 📖 このドキュメントを読むべき人

- ✅ **AIアシスタント**: 運用・保守作業を行う場合
- ✅ **運用担当者**: デプロイ手順やトラブルシューティングを確認したい場合
- ✅ **開発者**: 運用時の手順やメンテナンス方法を確認したい場合

**推奨読み順**: [docs/README.md](README.md) → [02_技術開発ガイド.md](02_技術開発ガイド.md) → このドキュメント

---

## 📋 概要

このドキュメントは、FlightAcademyTsxプロジェクトの運用、保守、トラブルシューティングについて説明します。

**最終更新**: 2025年12月26日
**バージョン**: Operations & Maintenance Guide v1.7

---

## 🎯 システム概要

### **目的**
- **自動化システム**: コード変更に伴うドキュメントの自動更新
- **品質保証**: ドキュメントの一貫性と正確性の確保
- **パフォーマンス最適化**: システム全体の性能向上
- **トラブルシューティング**: 問題の迅速な解決

### **主要機能**
- **ファイル監視**: ソースコードの変更を監視
- **自動更新**: 変更に基づくドキュメントの自動更新
- **検証機能**: ドキュメントの整合性チェック
- **Git hooks統合**: コミット前の自動実行

---

## 🔄 運用のポイント

### **テーマシステム統一（2025年12月21日）**
- **HUD固定スタイル**: Dayモード（HUDグリーン `#39FF14`）を固定使用
- **テーマ切り替え機能**: 削除（固定スタイルに統一）
- **スタイル制御**: Tailwind CSSクラスとCSS変数で直接制御

### **Supabase セキュリティLint対応**
- `public.v_mapped_questions` を SECURITY INVOKER 化
- 公開スキーマ上のバックアップテーブルを削除またはRLS有効化

### **管理者機能（ユーザーロール管理）**
- **画面**: `プロフィール > 管理者機能 > ユーザーロール管理`
- **機能**: `username/email`に対する部分一致検索、ロール変更
- **注意事項**: RLS（Row Level Security）が有効であること、Admin以外には表示されない

### **プロフィールページUI改善（2025年12月21日）**
- **入力フィールドのスタイル改善**: 編集モード/非編集モードの背景色・テキスト色を統一
- **パスワード更新日時の表示機能**: `password_updated_at`カラムを追加
- **入力フィールドアイコンの可視性改善**: 時間入力フィールドのアイコンを明るく表示

---

## ⚡ パフォーマンス改善

### **コード分割の実装**
- React.lazyを使用した動的インポート
- Suspenseコンポーネントでローディング状態を管理
- 手動チャンク分割でライブラリを分離

### **パフォーマンス改善結果**
- **メインバンドル**: 1,088.55 kB → 245.07 kB（77.5%削減）
- **分割チャンク**: react-vendor、map-vendor、supabase-vendor、ui-vendor、utils-vendor

---

## 🔧 トラブルシューティング

### **よくある問題と解決方法**

#### **ThemeContext参照エラー**
- **問題**: `ThemeContext`が未定義エラー
- **解決**: 全ファイルの`ThemeContext`依存を削除し、HUD固定スタイル（Dayモード）に統一（2025年12月21日完了）

#### **TypeScript型エラー**
- **問題**: `QuestionType`のインポートエラー
- **解決**: `src/constants.ts`のインポートパスを修正

#### **デバッグログの最適化**
- **問題**: 本番環境でも不要なコンソールログが出力される
- **解決**: 環境変数ベースのロガーユーティリティを作成、開発環境でのみデバッグ情報を表示

---

## 📚 データベース管理

### **SupabaseMCPでのprofilesスキーマ確認手順**
1. プロジェクトIDを確認: `FlightAcademy (project_id: fstynltdfdetpyvbrswr)`
2. 次のSQLをMCPから実行:
```sql
select column_name, data_type, is_nullable, column_default
from information_schema.columns
where table_schema = 'public' and table_name = 'profiles'
order by ordinal_position;
```
3. 型同期: `src/types/database.types.ts` の `profiles.Row` と齟齬があれば修正

---

## 🚀 開発環境

### **前提ツール**
- Node.js 16.x以上
- npm 7.x以上
- Git
- Cursor IDE（推奨）

### **開発サーバー起動**
```bash
npm run dev
```

### **ビルド**
```bash
npm run build
```

---

## 🧪 テスト・CI/CD運用

### **テスト実行**
```bash
# ローカルでのテスト実行
npm test              # ウォッチモード
npm run test:run      # 1回実行
npm run test:coverage # カバレッジ生成
npm run test:ui       # UIモード
```

### **CI/CD運用**
- **自動実行**: プルリクエスト・プッシュ時に自動実行
- **カバレッジレポート**: プルリクエストに自動コメント
- **手動実行**: GitHub Actionsの「Run workflow」から実行可能

### **トラブルシューティング（テスト）**
- **テストが失敗する場合**: `npm run lint`で型エラーを確認
- **カバレッジが生成されない場合**: `npm run test:coverage`を手動実行
- **CI/CDが失敗する場合**: GitHub Actionsのログを確認

---

## 📝 変更履歴

### **2025年1月 - CI/CD統合**
- GitHub Actionsワークフロー追加（テスト・ビルド検証）
- テストカバレッジレポート自動生成機能追加

### **2025年12月26日**
- `docs/db`ディレクトリを削除（記事作成作業管理用ファイル）

### **2025年12月21日**
- HUDテーマ削除、Whisky Papaテーマ統一
- プロフィールページUI改善（入力フィールドスタイル、パスワード更新日時表示）

### **2025年12月24日**
- リポジトリ整理作業完了（未使用ファイルの退避）

**詳細な変更履歴はGitのコミット履歴を参照してください。**

---

**最終更新**: 2025年1月（CI/CD統合）
**バージョン**: Operations & Maintenance Guide v1.8
**管理者**: FlightAcademy開発チーム
