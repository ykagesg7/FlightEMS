# Flight Academy プロジェクト概要ガイド

## 📖 このドキュメントを読むべき人

- ✅ **AIアシスタント**: プロジェクトの機能と技術スタックを理解したい場合
- ✅ **新規開発者**: プロジェクトの主要機能を把握したい場合
- ✅ **ステークホルダー**: プロジェクトの機能一覧を確認したい場合

**推奨読み順**: [docs/README.md](README.md) → [00_Flight_Academy_Strategy.md](00_Flight_Academy_Strategy.md) → このドキュメント

---

## 📋 プロジェクト概要

Flight Academy は、独立した航空学習プラットフォームです。React+TypeScript+Supabase を基盤とし、PPL/CPL 学科試験対策コンテンツ、フライトプランニングツール、ゲーミフィケーション、コミュニティ機能を提供します。記事はログインユーザーのみがアクセス可能で、セクションベースの進捗管理システムを採用しています。

**戦略**: ハイブリッド戦略 — コア機能は独立運営、パートナーシップは将来オプション。詳細は [00_Flight_Academy_Strategy.md](00_Flight_Academy_Strategy.md) を参照。

**最終更新**: 2026年2月7日
**バージョン**: Project Overview Guide v3.0

---

## 🎯 主な機能

### **学習コンテンツ管理**
- **MDXベースの記事システム**: Markdown + JSX形式で学習記事を管理
- **カテゴリー管理**: 基礎知識、メンタリティー、技術、実践の4カテゴリ
- **進捗管理**: ユーザー別の詳細な学習進捗トラッキング
- **タグ管理**: 記事の分類・検索機能

### **進捗・テスト連携**
- **CPL試験システム統合**: 学習記事とテスト問題の連携
- **学習-テストマッピング**: 記事内容と試験問題の関連付け
- **進捗ダッシュボード**: 学習状況の可視化

### **ソーシャル機能**
- **いいね・コメント機能**: 学習記事にTwitterライクなソーシャル機能
- **ユーザープロフィール**: アバター設定、プロフィール管理
- **ロール管理**: Student/Teacher/Admin の権限管理

### **フリーミアム公開**
- **一部記事無料公開**: 1.4, 1.5, 1.6記事等を無料で提供
- **アクセス制御**: 未ログインユーザー向けの適切な制限
- **ログイン促進**: 制限コンテンツへのアクセス時のログイン誘導

### **シリーズ順次アンロック機能（2025年11月2日実装）**
- **順次解放システム**: シリーズ記事を1話から順に読了で解放
- **未ログインユーザー**: 各シリーズの1話のみ閲覧可能
- **ログインユーザー**: 直前話の読了で次話が自動解放

### **認証**
- **メール/パスワード認証**: 基本的な認証機能
- **セッション管理**: 自動セッション更新、永続化
- **OAuth拡張予定**: Google、GitHub等の外部認証対応予定

### **SPAルーティング**
- **Marketing Routes**: `/`, `/about`, `/mission`, `/gallery`, `/schedule`, `/links`
- **App Routes**: `/dashboard`, `/planning`, `/articles`, `/articles/:contentId`, `/test`, `/profile`, `/auth`
- **Admin Routes**: `/admin/ranks`, `/admin/xp`, `/ranks`
- **リダイレクト**: `/shop` → `/`、`/blog` → `/mission`、`/experience` → `/mission`、`/learning` → `/articles`、`/account` → `/profile`
- **コード分割**: React.lazyによる動的インポート
- **404ハンドリング**: 未定義パスの適切な処理

### **パフォーマンス最適化**
- **仮想化システム**: react-windowによる大量データの効率的表示
- **バンドル最適化**: 77.5%のバンドルサイズ削減を達成
- **Core Web Vitals対応**: LCP < 2.5秒、FID < 100ms、CLS < 0.1

### **フライトプランニング**
- **インタラクティブ地図**: Leaflet.jsベースの航空地図表示
- **空港・NAVAID情報**: GeoJSON形式の地理データ管理
- **一般気象情報**: WeatherAPI.comによるリアルタイム気象データ取得
- **METAR/TAF統合**: NOAA Aviation Weather Center APIによる航空気象情報
- **サーバーサイドプロキシ**: CORS問題の解決とAPI呼び出しの最適化

### **お知らせ機能（2025年11月2日実装）**
- **Supabase統合**: `announcements`テーブルから最新情報を取得
- **HomePage統合**: Heroセクション直後に最新5件をカード形式で表示
- **レスポンシブデザイン**: モバイル1列、タブレット2列、デスクトップ3-5列のグリッドレイアウト

### **ゲーミフィケーション（"Learn, Plan, Fly"）**

- **ランクシステム**: 統合ランクシステム（PPL中間ランク + XPベースランク）
  - PPL中間ランク: Phase、Section、Category、Subjectレベル（記事完了ベース）
  - XPベースランク: Fan → PPL → Wingman → CPL → Ace → Master → Legend
- **XPシステム**: ミッション達成でXP獲得、ランクアップ判定
- **ミッションシステム**: クイズ完了、記事読了、プラン作成などのアクションで自動達成
- **Mission Dashboard**: ランク・XP・ミッション進捗の可視化
- **ストリーク**: 連続学習日数追跡、XPボーナス倍率

### **コミュニティ**
- **Interactive Gallery**: 航空写真投稿ギャラリー
  - イベント管理機能（アクティブイベントとアーカイブイベント）
  - いいね機能（承認済み写真のみ、アクティブイベントのみ）
  - Top3表示、ソート機能、タブ機能（公開/自分の投稿/管理）

### **レイアウト**
- **MarketingLayout**: 現在は黒×黄色基調（Phase Cでブランド移行予定）
- **AppLayout**: HUD固定スタイル（Dayモード、HUDグリーン `#39FF14`）

### **パートナーシップ機能（将来オプション — 現在無効）**

以下はパートナーシップ成立時に有効化する機能。コードはコメントアウト/リダイレクト状態で保持。

- **Hangar Store**: ランク連動型ショップ（`/shop` → ホームへリダイレクト中）
- **体験搭乗**: Coming Soonページのみ実装（`/experience` → `/mission`へリダイレクト中）
- **チーム紹介**: Aboutページのパイロット紹介セクション（コメントアウト中）

---

## 🛠️ 技術スタック

### **フロントエンド**
- **React 18**: Concurrent Mode、Suspense、useTransition
- **TypeScript**: 型安全性、開発効率向上
- **Vite**: 高速ビルドツール、動的チャンク分割
- **Tailwind CSS**: ユーティリティファーストのCSSフレームワーク

### **バックエンド**
- **Supabase**: データベース、認証、リアルタイム機能
- **PostgreSQL**: リレーショナルデータベース

### **地図・ナビゲーション**
- **Leaflet**: インタラクティブ地図ライブラリ
- **React-Leaflet**: React用Leafletラッパー
- **GeoJSON**: 地理データ形式

### **外部API**
- **WeatherAPI.com**: 一般気象情報API（要APIキー）
- **NOAA Aviation Weather Center API**: 航空気象データAPI（認証不要・無料）

---

## 📊 データベース拡張

### **主要テーブル**
- **profiles**: ユーザープロファイル
- **questions**: 問題データ
- **learning_records**: 学習記録
- **user_question_srs_status**: SRS（間隔反復学習）ステータス
- **gallery_events**: Galleryイベント管理
- **fan_photos**: ユーザー投稿写真
- **fan_photo_likes**: いいねデータ
- **learning_progress**: 記事学習進捗
- **learning_content_comments**: 記事コメント

---

## 🎨 新規コンポーネント

### **Gallery機能（2025年12月実装）**
- **PhotoGrid**: 写真グリッド表示（Masonryレイアウト、Lightbox機能）
- **UploadModal**: 写真アップロードモーダル（ドラッグ&ドロップ対応）
- **AdminEventPanel**: イベント管理パネル（管理者専用）
- **AdminReviewPanel**: 承認管理パネル（管理者専用）

### **記事システム**
- **ArticleDetailPage**: 記事詳細ページ
- **ReadingProgressBar**: 残り時間表示・進捗管理
- **MDXLoader**: 動的記事読み込み
- **CommentSection**: コメント機能
- **TableOfContents**: 目次・ナビゲーション

---

## 📝 最近の変更

### **2026年2月7日**
- ハイブリッド戦略への転換（Flight Academyとして独立路線）
- 戦略ドキュメント刷新（00_, 03_, README, 01_）

### **2026年2月1日**
- ACC Sector / RAPCONポップアップ追加（空域クリック時の詳細表示）

### **2026年1月**
- PPLランクシステム統合、KaTeX数式記法サポート追加
- PPL記事15件完了（Phase 1: 13件、Phase 2: 2件）
- テスト環境修正、記事ステータス判定改善

**詳細な変更履歴はGitのコミット履歴を参照してください。**

---

## 🧪 テスト・CI/CD（2025年1月追加）

### **テストフレームワーク**
- **Vitest**: テストフレームワーク（39テスト、6ファイル）
- **Testing Library**: Reactコンポーネントテスト
- **カバレッジ**: v8プロバイダー、閾値設定済み

### **CI/CDパイプライン**
- **GitHub Actions**: プルリクエスト・プッシュ時に自動実行
- **自動検証**: Lint、テスト、ビルド、カバレッジレポート
- **カバレッジコメント**: プルリクエストに自動追加

詳細は [プロジェクトルートのREADME.md](../README.md#テスト) を参照してください。

---

**最終更新**: 2026年2月7日（ハイブリッド戦略転換）
**バージョン**: Project Overview Guide v3.0
**管理者**: Flight Academy 開発チーム
