# Flight Academy 改善ロードマップ

## 概要
このドキュメントは、Flight Academyアプリケーションの長期的な改善計画をまとめたものです。ユーザー体験の向上、機能の拡張、パフォーマンスの最適化を段階的に実装していく計画を示しています。

## 最近実装された機能（2025年1月）

### Phase 5: 開発環境安定化・セキュリティ強化（2025年1月）
- **ルーティング問題解決**
  - AuthPage (`/auth`) とArticleStatsTestPage (`/test`) のルート追加
  - 「ページが見つかりません」エラーの根本解決
  - React Router設定の最適化

- **機密情報管理完了**
  - Weather API、Supabase、Google APIs (Gemini, Cloud Vision) の環境変数化
  - Email Services (Gmail SMTP, Brevo) の安全な設定
  - TypeScript型定義追加、Supabaseクライアント環境変数化
  - .env.example/.env.productionの更新

- **開発環境最適化**
  - Vite動的チャンク分割最適化
  - Babel重複エラー修正
  - React 18 Concurrent Features完全実装
  - EnhancedErrorBoundary包括的エラーハンドリング

### 0. インタラクティブ学習ページの統合（2024年7月）
- TACAN進入方式を実践的に学べる「インタラクティブ学習」ページを新規追加
- 既存Learningページのリスト上部にリンクを設置し、誰でもアクセス可能に
- ルーティング（/interactive-learning）を追加し、プロジェクト全体に統合
- 重複していた設定ファイル等を整理

### 1. 認証機能
- Supabase Authを使用したユーザー認証の実装
  - メール/パスワードによるログイン・登録機能
  - セッション管理とユーザー状態の管理
  - プロテクテッドルートの実装
- ユーザープロファイル管理
  - プロファイル情報の編集
  - アバター設定
  - ユーザーロール（Student/Teacher/Admin）の導入

### 2. Learning機能の拡充
- ユーザー別の進捗管理
- 認証ユーザー限定コンテンツの提供
- プロファイル情報の表示

### 3. LearningページUI/UX・ナビゲーション改善（2024年7月）
- サイドバーから学習コンテンツをカテゴリ・タイトルで一覧表示し、クリックで即座に記事を閲覧できるようにした
- サイドバーの開閉（ハンバーガーメニュー）・ドロワー型UIをモバイル対応で実装
- サイドバーで現在閲覧中の記事が青色背景で分かるように強調
- 記事閲覧画面の上下に「←」「→」「一覧」ボタンを設置し、記事の前後移動や一覧への戻りを容易に
- 「完了」ボタンを一時的に削除し、進捗管理UIは今後の実装に委ねた
- サイドバー・記事表示の状態同期を強化し、UXを向上

### 4. ソーシャル機能とフリーミアム機能の実装（2025年5月）
- **新記事追加**: 1.6_SeekFirstToUnderstand.mdx（メンタリティーカテゴリー）
- **いいね・コメント機能**: 学習記事にTwitterライクなソーシャル機能を実装
  - リアルタイムでのいいね・コメント投稿
  - ユーザープロフィール連携
  - ダークモード対応UI
- **フリーミアム機能**: 1.4, 1.5, 1.6記事を無料公開対象に設定
  - 動的なフリーミアム記事管理
  - 未ログインユーザー向けプレビュー機能
- **認証システム統一**: AuthContextからZustand AuthStoreへの移行
- **Supabaseセキュリティ強化**:
  - RLSポリシーの設定
  - 関数のsearch_path設定
  - セキュリティ警告の解消
- **UI/UX改善**:
  - Learning一覧画面にいいね・コメント数表示
  - フリーミアムバッジの表示
  - レスポンシブデザインの改善

### 5. CPL航空法シリーズコンテンツ作成（2025年6月）
- **新カテゴリ追加**: CPL航空法シリーズの開始
  - 戦闘機パイロット向け航空法教育コンテンツ
  - キャラクター設定（トム兄ぃ、浪速のゾウさん）による魅力的なストーリーテリング
- **4記事同時リリース**:
  - 3.0_AviationLegal0.mdx（Mission 0: 完全攻略ブリーフィング）- フリーミアム
  - 3.1_AviationLegal1.mdx（Mission 1-1: 技能証明）- プレミアム
  - 3.2_AviationLegal2.mdx（Mission 1-2: 航空身体検査証明）- プレミアム
  - 3.3_AviationLegal3.mdx（Mission 2-1: 耐空証明）- プレミアム
- **MDXシステム統合**: 既存のMDXローダー・表示システムとの完全統合
- **learning_contentsデータベース統合**: 新しいカテゴリとコンテンツの管理システム統合
- **フリーミアム戦略**: Mission 0を無料公開として新規ユーザー獲得を図る

## フェーズ6: 技術的負債解消・システム統合（2025年2月-3月）

### 1. Supabase警告対応・最適化
- **複数インスタンス警告の解決**
  - GoTrueClient複数インスタンス検出の根本原因調査
  - Supabaseクライアントの一元管理システム構築
  - セッション管理の最適化

- **データベース最適化**
  - インデックス設計の見直し
  - クエリパフォーマンスの改善
  - RLS（Row Level Security）ポリシーの最適化

### 2. 型安全性完全達成
- **any型完全削除**
  - 残存any型の段階的削除（目標: 0箇所）
  - 厳密な型定義の導入
  - TypeScript strict modeの完全対応

- **テストカバレッジ拡大**
  - 単体テスト・統合テストの拡充
  - 80%カバレッジ目標の達成
  - CI/CDパイプラインでの自動テスト実行

### 3. CPL試験システム統合準備
- **学習・テスト連携基盤**
  - Learning-Test連携機能の設計
  - CPL試験データベース設計
  - 出題傾向分析システムの準備

## フェーズ1: UI/UX改善（1-2ヶ月）

### 1. コンテンツ一覧表示の改善
- モダンなカードレイアウトの実装
  - グリッドベースのレスポンシブデザイン
  - カードのホバーエフェクト
  - サムネイル画像の最適化
- 検索・フィルタリング機能の強化
  - インクリメンタル検索
  - カテゴリ/タグによるフィルタリング
  - ソート機能の追加
- パフォーマンス最適化
  - 仮想スクロールの実装
  - 画像の遅延読み込み
  - キャッシュ戦略の改善

### 2. ナビゲーションの改善
- パンくずリストの実装
- サイドバーナビゲーションの最適化
- モバイル対応の強化

## フェーズ2: LMS機能の拡張（2-3ヶ月）

### 1. Learning-Test連携機能の実装 ★新機能★
#### Phase 1: 基本連携機能（2週間）
- **相互ナビゲーション機能**
  - Learning記事の最後に「関連テストを受ける」ボタン追加
  - Test結果画面で「復習記事を読む」リンク追加
  - 学習記事とテスト問題のマッピングテーブル実装

- **データベース設計拡張**
  ```sql
  -- 学習テスト連携テーブル
  CREATE TABLE learning_test_mapping (
    id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
    learning_content_id varchar NOT NULL,
    test_question_ids text[], -- 配列で複数問題ID
    difficulty_level integer DEFAULT 1,
    topic_category varchar,
    created_at timestamp DEFAULT now()
  );
  ```

#### Phase 2: 試験逆算学習システム（拡張版・5週間） ★アップグレード★
- **CPL試験データ管理システム** ★新規追加★
  - CPL学科試験PDFデータの体系的収集・整理
  - MarkItDownによる一括マークダウン変換プロセス
  - 変換品質の検証・校正システム
  ```sql
  -- 試験問題メタデータテーブル
  CREATE TABLE exam_questions_metadata (
    id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
    exam_year integer,
    exam_month integer,
    question_number integer,
    subject_category varchar, -- 7科目分類
    sub_category varchar,     -- 詳細分野
    difficulty_level integer, -- 1-5の難易度
    appearance_frequency integer, -- 過去の出題回数
    source_document varchar,  -- 元PDFファイル名
    markdown_content text,    -- 変換されたMarkdown
    created_at timestamp DEFAULT now()
  );
  ```

- **出題傾向分析システム** ★新規追加★
  - 年度別・科目別出題統計の自動生成
  - 重要度スコアリング算出（出題頻度×難易度×最新性）
  - トレンド分析（新規出題パターンの検出）
  - 分析結果のマークダウンレポート自動生成
  - 記事作成優先度の定量的ガイダンス

- **CPL試験問題分析機能**
  - 過去問データベースの構築（PDF→Markdown→DB統合フロー）
  - 問題カテゴリ分類システム（7科目×詳細分野）
  - 出題頻度・重要度の数値化

- **データドリブン記事作成支援** ★新規追加★
  ```typescript
  interface ContentAnalysis {
    subjectCategory: string;
    examCoverage: number;        // 0-100%
    articleCount: number;
    missingTopics: string[];
    priorityScore: number;       // 1-10
    recommendedArticles: {
      title: string;
      estimatedImpact: number;
      targetQuestions: string[];
    }[];
  }
  ```
  - 出題頻度データに基づく重点記事テーマ提案
  - 科目別カバレッジ分析（記事⇔試験問題のマッピング）
  - 記事の試験対策効果測定・最適化

- **学習記事のタグ付け強化**
  - 各Learning記事への試験問題カテゴリ紐付け
  - 学習進捗と試験対策の連携強化
  - 科目別・分野別の習熟度可視化

#### Phase 3: 適応的学習パス（4週間）
- **弱点分析エンジン**
  - Test結果の詳細分析
  - 苦手分野の自動特定
  - 対応するLearning記事の自動推薦

- **パーソナライズド学習フロー**
  ```typescript
  interface LearningRecommendation {
    userId: string;
    contentId: string;
    contentType: 'learning' | 'test';
    recommendationReason: string;
    priorityScore: number;    // 1-10の重要度
    estimatedStudyTime: number; // 分
    difficultyLevel: number;  // 1-5の難易度
  }
  ```

#### Phase 4: 進捗統合管理（2週間）
- **統合ダッシュボード**
  - 学習記事完了率とテスト正答率の統合表示
  - CPL合格可能性の予測指標
  - 「CPL合格まであと○○日」機能

- **学習科学の適用**
  - 分散学習（Spaced Repetition）システム
  - 間違えた問題の関連記事を時間差で再推薦
  - 記憶定着度を考慮した復習タイミング最適化

### 2. 進捗管理システムの強化
- 詳細な進捗トラッキング
  - セクションごとの完了率
  - 学習時間の計測
  - 達成度の可視化
- 学習目標の設定と管理
- カスタム学習パスの作成

### 3. インタラクティブ要素の追加
- クイズ機能の実装
  - 多肢選択問題
  - 記述式問題
  - 即時フィードバック
- 実践演習の追加
  - シミュレーション
  - ケーススタディ
  - グループワーク

### 4. コミュニティ機能
- ディスカッションフォーラム
- ピアレビューシステム
- メンターシップ機能

### 5. データベース連携の強化
- Supabaseとの連携強化
  - リアルタイムデータの活用
  - ロール別権限管理の実装
  - データベースルールの最適化
- Supabase Authを活用したユーザー認証の強化
  - ソーシャルログイン連携
  - 多要素認証の実装
  - ユーザーロール管理の改善

## フェーズ3: パフォーマンスとスケーラビリティ（1-2ヶ月）

### 1. バックエンド最適化
- APIレスポンスの最適化
- データベースクエリの改善
- キャッシュ戦略の実装

### 2. フロントエンド最適化
- コード分割の実装
- バンドルサイズの最適化
- レンダリングパフォーマンスの改善

### 3. インフラストラクチャの改善
- CDNの導入
- スケーリング戦略の実装
- モニタリングシステムの強化

## フェーズ4: 新機能開発（3-4ヶ月）

### 1. モバイルアプリケーション
- ネイティブアプリの開発
- オフライン機能の実装
- プッシュ通知の実装

### 2. 高度な分析機能
- 学習分析ダッシュボード
- パーソナライズされたレコメンデーション
- パフォーマンス予測

### 3. 統合機能
- 外部LMSとの連携
- サードパーティツールとの統合
- APIの拡張

## 実装の優先順位

1. ユーザー体験に直接影響するUI/UX改善
2. コアLMS機能の拡張
3. パフォーマンス最適化
4. 新機能開発

## 技術スタック

### フロントエンド
- React
- TypeScript
- Tailwind CSS
- React Query
- React Router

### バックエンド
- Supabase
- PostgreSQL
- Supabase Functions (EdgeFunctions)
- Supabase Auth

### インフラストラクチャ
- Vercel
- Supabase Cloud
- GitHub Actions
- Cursor IDE (MCP機能)

## 成功指標

1. ユーザーエンゲージメント
   - 平均セッション時間
   - ページビュー数
   - バウンス率

2. パフォーマンス
   - ページロード時間
   - APIレスポンス時間
   - エラー率

3. ユーザー満足度
   - NPSスコア
   - ユーザーフィードバック
   - 機能利用率

## リスク管理

1. 技術的リスク
   - 新技術の採用による複雑性の増加
   - パフォーマンスへの影響
   - セキュリティリスク

2. プロジェクトリスク
   - スケジュールの遅延
   - リソースの制約
   - 要件の変更

## 定期的なレビュー

- 週次進捗レビュー
- 月次マイルストーンレビュー
- 四半期計画の見直し

## 更新履歴

- 2025-05-27: ソーシャル機能とフリーミアム機能の実装完了
  - 1.6_SeekFirstToUnderstand.mdx記事追加
  - いいね・コメント機能実装
  - 認証システム統一（AuthStore移行）
  - Supabaseセキュリティ強化
- 2025-05-25: Learning記事「1.5_WinWinThinking.mdx」新規追加。記事構造・装飾・画像挿入コメントを含む完全版を作成し、learning_contentsテーブルに登録。最新3記事（1.3, 1.4, 1.5）がフリーミアム対象となるようuseFreemiumAccess.ts等を更新。
- 2024-03-10: 初版作成
- 2024-07-17: Supabase認証機能を実装、ユーザー認証関連の項目を更新
- 2024-07-10: UI/UX改善計画の詳細化

## 今後のTODO（2024年7月以降）
- 学習進捗管理UIの実装（記事ごとの進捗率・完了管理・復習サポート）
- ユーザーフィードバックをもとにUI/UXのさらなる改善
- サイドバーのアクセシビリティ向上（キーボード操作・ARIA属性の強化）
- 記事内検索・ハイライト機能の追加
- クイズ・演習・コミュニティ機能との連携強化
- 管理者向けのコンテンツ管理・同期機能の拡充
