# FlightAcademyTsx - 開発ガイド

このドキュメントは、FlightAcademyTsxプロジェクトの開発に参加するための包括的なガイドラインを提供します。コードの構造、開発状況、コントリビューションの方法について解説します。

## 目次

1. [開発状況](#開発状況)
2. [プロジェクト構造](#プロジェクト構造)
3. [開発環境のセットアップ](#開発環境のセットアップ)
4. [コーディング規約](#コーディング規約)
5. [Git/GitHub連携](#githubの連携)
6. [Issue・PRの作成方法](#issueprの作成方法)

## 開発状況

### 現在の実装状況

#### ✅ 基本機能
- インタラクティブな地図表示（Leaflet.js）
- 基本レイヤー（地図、衛星写真）の切り替え
- オーバーレイレイヤー（空港、制限空域、高高度訓練空域など）の表示
- 空港、ウェイポイント、NAVAIDの表示と対話機能
- フライトパラメータ（速度、高度、出発時間）の設定と計算
- フライトプランの作成と管理（出発地、経由地、目的地）
- ウェイポイントのマップ上からの追加機能
- フライトサマリーの計算（総距離、ETE、ETA）
- ルートセグメントごとの詳細情報の表示
- 出発空港の選択時に地上標高・地上気温を自動設定
- 気象データのキャッシュ機能
- マニューバービューア機能

#### 最近追加された機能
- 「ルートに追加」ボタンによるマップ上からのウェイポイント追加
- セグメントごとの詳細情報の計算と表示
- 空港マーカーと気象情報表示の改善
- TASとMachの微調整機能
- UI/UXの改善
- ウェイポイントデータの管理改善
- 飛行場データの活用強化
- mermaidライブラリの追加によるダイアグラム描画機能

### 技術的課題

- **API管理**: 環境変数によるAPIキー管理の改善
- **CORS対応**: WeatherAPIへの直接アクセスのCORS問題
- **UI/UX**: 空港アイコンの視認性向上、マニューバービューアの機能強化
- **パフォーマンス**: 大量のウェイポイントを扱う際の最適化、マニューバーアニメーションの最適化
- **型安全性**: イベントハンドラやコンポーネント間のデータ受け渡しの改善
- **エラーハンドリング**: 気象データ取得失敗時のユーザー向けエラー表示の改善

### 開発計画

#### 短期計画（〜1ヶ月）
- APIキー管理の改善
- UIの改善（空港アイコン、気象情報ポップアップなど）
- ウェイポイント機能の強化
- ウェイポイントデータ管理の改善
- マニューバービューアの機能強化

#### 中期計画（1〜3ヶ月）
- フライトプラン機能の強化（保存/読み込み、詳細設定）
- 気象情報の拡張（予報データ、METARとTAFの統合）
- ドキュメント整備
- マニューバーシミュレーション拡張（3D表示など）

#### 長期計画（3ヶ月〜）
- フライトシミュレーターとの連携
- コミュニティ機能の実装
- テスト強化とCI/CDパイプラインの充実
- モバイル対応（レスポンシブ、PWA）
- 高度な訓練シミュレーション

## プロジェクト構造

```
FlightAcademyTsx/
├── docs/                   # ドキュメント
│   ├── README.md           # プロジェクト概要
│   ├── DEVELOPMENT.md      # 開発ガイド（このファイル）
│   ├── ADVANCED.md         # 高度な機能・トラブルシューティング
│   └── troubleshooting/    # トラブルシューティングガイド
├── public/                 # 静的ファイル
│   ├── geojson/            # 地理データ
│   ├── maneuver/           # マニューバーアニメーション
│   └── images/             # 画像ファイル
├── scripts/                # ユーティリティスクリプト
├── src/                    # ソースコード
│   ├── components/         # Reactコンポーネント
│   ├── contexts/           # Reactコンテキスト
│   ├── hooks/              # カスタムフック
│   ├── types/              # TypeScript型定義
│   ├── utils/              # ユーティリティ関数
│   └── App.tsx             # メインアプリケーション
├── .env.example            # 環境変数テンプレート
├── package.json            # プロジェクト依存関係
└── tsconfig.json           # TypeScript設定
```

## 開発環境のセットアップ

### クイックスタート

1. リポジトリをフォークする
2. フォークしたリポジトリをクローンする：`git clone https://github.com/あなたのユーザー名/FlightAcademyTsx.git`
3. 依存関係をインストールする：`npm install`
4. 環境変数を設定する：`.env.local`ファイルを作成
5. 開発サーバーを起動する：`npm run dev`

### 環境変数の設定

`.env.example`ファイルを参照し、必要な環境変数を`.env.local`に設定してください：

```
VITE_WEATHER_API_KEY=your_weather_api_key
```

**重要**: APIキーなどの機密情報をコードに直接ハードコードしないでください。

## コーディング規約

### 命名規則

- **コンポーネント**: PascalCase（例: `FlightParameters.tsx`）
- **関数**: camelCase（例: `calculateDistance`）
- **変数**: camelCase（例: `totalDistance`）
- **定数**: UPPER_SNAKE_CASE（例: `MAX_ALTITUDE`）
- **ファイル名**: コンポーネントはPascalCase、その他はcamelCase

### TypeScript

- 可能な限り`any`型を避け、具体的な型または型定義を使用する
- 複雑なデータ構造には適切なインターフェイスを定義する
- optional chainingを活用して型安全性を確保する
- 非同期操作には適切なエラーハンドリングを実装する

### ファイル構成

- 関連するロジックは適切なディレクトリに配置する
- コンポーネントはできるだけ小さく、再利用可能にする
- ビジネスロジックとUI表示を分離する
- ユーティリティ関数は`utils`ディレクトリに配置する

### スタイリング

- Tailwind CSSのユーティリティクラスを活用する
- コンポーネント特有のスタイルは適切に名前空間を分ける
- レスポンシブデザインを考慮する
- アクセシビリティガイドラインに従う

## GitHubの連携

### ブランチ戦略

1. **mainブランチ**: 安定版のコードを含む主要ブランチ
2. **feature/\***: 新機能開発用のブランチ
3. **bugfix/\***: バグ修正用のブランチ
4. **release/\***: リリース準備用のブランチ

### 基本的なワークフロー

1. 新しいブランチを作成する：`git checkout -b feature/あなたの機能名`
2. 変更を加える
3. コードの品質を確認する：`npm run lint`
4. テストを実行する：`npm run test`（※現在テストは実装段階です）
5. 変更をコミットする：`git commit -m "機能の説明"`
6. フォークしたリポジトリにプッシュする：`git push origin feature/あなたの機能名`
7. プルリクエストを作成する

### コンフリクト解決

コンフリクトが発生した場合は、以下のステップで解決してください：

1. コンフリクトのあるファイルを特定する
2. コンフリクトマーカー（`<<<<<<< HEAD`, `=======`, `>>>>>>> master`）を確認する
3. 適切な変更を行い、マーカーを削除する
4. 変更をステージングエリアに追加: `git add <ファイル名>`
5. 変更をコミット: `git commit -m "Resolve merge conflicts"`

## Issue・PRの作成方法

### バグ報告
```
## バグの説明
どのようなバグが発生したか簡潔に説明してください

## 再現手順
1. '...' に移動
2. '....' をクリック
3. '....' までスクロール
4. エラーを確認

## 期待される動作
どのような動作が期待されるか説明してください

## スクリーンショット
可能であれば、問題を説明するスクリーンショットを追加してください

## 環境情報
 - OS: [例: Windows 10, macOS 11.2]
 - ブラウザ: [例: Chrome 90, Safari 14]
 - アプリバージョン: [例: v1.0.0]
```

### 機能リクエスト
```
## 関連する問題
この機能リクエストがどのような問題を解決するか説明してください

## 提案する解決策
実装してほしい機能について説明してください

## 代替案
検討した他の解決策や機能があれば記載してください

## その他の情報
機能を理解するために役立つ情報やスクリーンショットを追加してください
```

### プルリクエストチェックリスト

プルリクエストを提出する前に、以下のチェックリストを確認してください：

- [ ] コードはTypeScriptの型安全性に準拠している
- [ ] 新しいコンポーネントはコンポーネント命名規則に従っている
- [ ] コードは既存のスタイルガイドに従っている
- [ ] すべての不要なコンソールログとデバッグコードが削除されている
- [ ] 既存の機能が損なわれていないことを確認した
- [ ] ドキュメントが更新されている（必要な場合）
- [ ] 環境変数の変更がある場合は`.env.example`が更新されている

---

最終更新日: 2025年4月19日
